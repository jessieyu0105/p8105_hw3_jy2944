---
title: "p8105_hw3_jy2944"
author: "Jie Yu"
date: 2018-10-11
output: 
  github_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

# download p8105.datasets
devtools::install_github("p8105/p8105.datasets")
library(p8105.datasets)

theme_set(theme_bw())

```


# Problem 1

This problem uses the BRFSS data. 

### Load data and do some data cleaning

```{r brfss_data, warning = FALSE, message = FALSE}

data("brfss_smart2010")

brfss_data = brfss_smart2010 %>%
  janitor::clean_names() %>%
  # format the data to use appropriate variable names
  separate(locationdesc, into = c("state_str", "location"), sep = " - ") %>%
  select(-state_str) %>%
  rename(state_abbr = locationabbr) %>%
  # focus on "Overall Health" topic
  filter(topic == "Overall Health") %>% 
  # remove the variables which I do not need
  select(-(class:question), 
         -sample_size, 
         -(confidence_limit_low:geo_location)) %>%
  # organize responses as a factor taking levels ordered from "Excellent" to "Poor"
  mutate(response = forcats::fct_relevel(factor(response), c("Excellent", "Very good", "Good", "Fair", "Poor")))

```

### Answers based on the dataset

_1. In 2002, which states were observed at 7 locations?_

```{r p1_1}
brfss_data %>% 
  # filter by year
  filter(year == 2002) %>% 
  # group by state
  group_by(state_abbr) %>% 
  # summarize number of locations in each state
  summarise(n_location = n_distinct(location)) %>% 
  filter(n_location == 7) %>% 
  knitr::kable()
```

From above table, we find that Connecticut, Florida, North Carolina were observed at 7 loacations in 2002.


_2. Make a “spaghetti plot” that shows the number of locations in each state from 2002 to 2010._

```{r p1_2}
brfss_data %>% 
  # group by year and state
  group_by(year, state_abbr) %>% 
  # find the number of distinct location in each year
  distinct(location) %>% 
  summarise(number = n()) %>% 
  # spaghetti plot
  ggplot(aes(x = year, y = number, color = state_abbr)) +
  geom_line() +
  geom_point() +
   labs(
    title = "Number of locations in each State from 2002 to 2010", 
    x = "Year", 
    y = "Number of locations",
    # change the legend name
    color = "State"
    ) 
```

Comments?


_3. Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State._

```{r, p1_3}
brfss_data %>% 
  # filter year
  filter(year == 2002 | year == 2006 | year == 2010) %>% 
  # filter NY
  filter(state_abbr == "NY") %>% 
  # filter "Excellent"
  filter(response == "Excellent") %>% 
  # group by state and year
  group_by(state_abbr, year) %>% 
  summarize(
    excellent_mean = mean(data_value, na.rm = TRUE),
    excellent_sd = sd(data_value, na.rm = TRUE)
    ) %>%
  knitr::kable(digits = 2)
```

The above table suggests: among the years 2002, 2006, and 2010, the mean of the proportion of "Excellent" responses in NY state was highest in year 2002 (24.04%), and lowest in year 2006 (22.53%); the varibility of the proportion was biggest in year 2002 (±4.49%) and smallest in year 2010 (±3.57%).


_4. For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time._

```{r p1_4}
brfss_data %>% 
  # group by year, state, and response
  group_by(year, state_abbr, response) %>% 
  summarise(mean = mean(data_value, na.rm = TRUE)) %>% 
  # Boxplot, group by year
  ggplot(aes(x = year, y = mean, group = year)) +
  geom_boxplot() +
  labs(
    title = "State-level average proportion in each response category from 2002 to 2010", 
    x = "Year", 
    y = "Average Proportion"
    ) +
  # faceting: divide the plot into 5 subplots based on response category
  facet_grid(. ~ response) +
  theme(axis.text.x = element_text(angle = 90))
```



